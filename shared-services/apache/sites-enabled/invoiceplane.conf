# InvoicePlane Apache configuration
# Static files served locally, PHP proxied to invoiceplane:9000

<VirtualHost *:80>
    ServerName invoices.kensai.cloud
    DocumentRoot /var/www/invoiceplane

    <Directory /var/www/invoiceplane>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    # Deny access to sensitive paths
    <DirectoryMatch "^/var/www/invoiceplane/(application|system|vendor)">
        Require all denied
    </DirectoryMatch>

    # Hide dotfiles
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>

    # Static assets - served directly by Apache
    <LocationMatch "\.(jpg|jpeg|gif|png|bmp|ico|svg|css|js|woff|woff2|ttf|eot|swf)$">
        ExpiresActive On
        ExpiresDefault "access plus 30 days"
        Header set Cache-Control "public, immutable"
    </LocationMatch>

    # PHP files - proxy to PHP-FPM
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://invoiceplane:9000"
    </FilesMatch>

    # Set HTTPS headers for reverse proxy
    SetEnvIf X-Forwarded-Proto "https" HTTPS=on

    # Logging to stdout/stderr for docker
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined
</VirtualHost>
